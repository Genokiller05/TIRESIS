<div class="min-h-screen bg-gray-100 dark:bg-gray-900 font-display text-gray-800 dark:text-gray-200">
  <div class="flex h-screen">
    <app-sidebar></app-sidebar>

    <!-- Main Content -->
    <main class="flex-1 p-8 flex flex-col">
      <div class="container mx-auto flex flex-col h-full">
        <header class="mb-8 flex justify-between items-center flex-shrink-0">
          <div>
            <h1 class="text-4xl font-bold text-gray-900 dark:text-white">{{ uiText.pageTitle }}</h1>
            <p class="text-gray-600 dark:text-gray-400 mt-1">{{ uiText.pageSubtitle }}</p>
          </div>
        </header>

        <div class="bg-white dark:bg-gray-800 p-6 rounded-2xl border border-gray-200 dark:border-gray-700 flex flex-col flex-grow min-h-0">
          <!-- Filters -->
          <div class="flex-shrink-0">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-xl font-semibold text-gray-900 dark:text-white">{{ uiText.filtersTitle }}</h2>
                <div class="flex space-x-2">
                    <button (click)="limpiarFiltros()" class="bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600 text-gray-800 dark:text-gray-300 font-medium py-2 px-4 rounded-lg flex items-center space-x-2">
                        <span class="material-icons !text-xl">clear</span>
                        <span>{{ uiText.clearFiltersButton }}</span>
                    </button>
                </div>
            </div>
            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 items-end mb-8">
              <div>
                <label class="block text-sm font-medium text-gray-700 dark:text-gray-400 mb-1" for="filter-desde">{{ uiText.fromLabel }}</label>
                <input class="w-full px-3 py-2 bg-gray-100 dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-lg text-gray-900 dark:text-gray-100 focus:ring-purple-500 focus:border-purple-500" id="filter-desde" type="datetime-local" [(ngModel)]="filterDesde" (change)="aplicarFiltros()"/>
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-700 dark:text-gray-400 mb-1" for="filter-hasta">{{ uiText.toLabel }}</label>
                <input class="w-full px-3 py-2 bg-gray-100 dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-lg text-gray-900 dark:text-gray-100 focus:ring-purple-500 focus:border-purple-500" id="filter-hasta" type="datetime-local" [(ngModel)]="filterHasta" (change)="aplicarFiltros()"/>
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-700 dark:text-gray-400 mb-1" for="filter-origen">{{ uiText.originLabel }}</label>
                <select class="w-full px-3 py-2 bg-gray-100 dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-lg text-gray-900 dark:text-gray-100 focus:ring-purple-500 focus:border-purple-500" id="filter-origen" [(ngModel)]="filterOrigen" (change)="aplicarFiltros()">
                  <option value="Todos">{{ uiText.allOption }}</option>
                  <option *ngFor="let option of uiText.originOptions" [value]="option">{{ option }}</option>
                </select>
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-700 dark:text-gray-400 mb-1" for="filter-tipo">{{ uiText.alertTypeLabel }}</label>
                <select class="w-full px-3 py-2 bg-gray-100 dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-lg text-gray-900 dark:text-gray-100 focus:ring-purple-500 focus:border-purple-500" id="filter-tipo" [(ngModel)]="filterTipo" (change)="aplicarFiltros()">
                  <option value="Todos">{{ uiText.allOption }}</option>
                  <option *ngFor="let option of uiText.alertTypeOptions" [value]="option">{{ option }}</option>
                </select>
              </div>
            </div>
          </div>

          <!-- Scrolling content: Alerts Table -->
          <div class="overflow-y-auto flex-grow">
            <div class="overflow-x-auto">
              <table class="w-full text-left">
                <thead>
                  <tr class="border-b border-gray-200 dark:border-gray-700 text-sm text-gray-600 dark:text-gray-400">
                    <th class="py-3 px-4 font-medium">{{ uiText.tableHeaderDate }}</th>
                    <th class="py-3 px-4 font-medium">{{ uiText.tableHeaderOrigin }}</th>
                    <th class="py-3 px-4 font-medium">{{ uiText.tableHeaderAlertType }}</th>
                    <th class="py-3 px-4 font-medium">{{ uiText.tableHeaderSite }}</th>
                    <th class="py-3 px-4 font-medium">{{ uiText.tableHeaderStatus }}</th>
                    <th class="py-3 px-4 font-medium">{{ uiText.tableHeaderActions }}</th>
                  </tr>
                </thead>
                <tbody class="divide-y divide-gray-100 dark:divide-gray-700">
                  <tr *ngIf="displayedAlerts.length === 0">
                      <td colspan="6" class="py-10 text-center text-gray-500 dark:text-gray-400">{{ uiText.noRecordsMessage }}</td>
                  </tr>
                  <tr *ngFor="let alerta of displayedAlerts">
                      <td class="py-4 px-4 text-gray-700 dark:text-gray-300">{{ alerta.fechaHora | date:'dd/MM/yyyy HH:mm' }}</td>
                      <td class="py-4 px-4 text-gray-700 dark:text-gray-300">
                        <span [ngClass]="getOriginChipClasses(alerta.origen)">{{ alerta.origen }}</span>
                      </td>
                      <td class="py-4 px-4 text-gray-700 dark:text-gray-300">{{ alerta.tipo }}</td>
                      <td class="py-4 px-4 text-gray-700 dark:text-gray-300">{{ alerta.sitioArea }}</td>
                      <td class="py-4 px-4">
                        <span [ngClass]="getStatusChipClasses(alerta.estado)">{{ alerta.estado }}</span>
                      </td>
                      <td class="py-4 px-4 relative">
                        <button (click)="toggleMenu(alerta)" class="text-gray-500 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white focus:outline-none">
                          <span class="material-icons">more_vert</span>
                        </button>
                        <!-- Dropdown Menu -->
                        <div *ngIf="alerta.menuVisible" class="absolute right-4 mt-2 w-48 bg-white dark:bg-gray-700 border border-gray-200 dark:border-gray-600 rounded-lg shadow-xl z-10">
                          <a (click)="modificarEstado(alerta)" class="block px-4 py-2 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-600 cursor-pointer">{{ uiText.modifyStatusAction }}</a>
                          <a (click)="mostrarDetalles(alerta)" class="block px-4 py-2 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-600 cursor-pointer">Detalles</a>
                          <a (click)="eliminarAlerta(alerta)" class="block px-4 py-2 text-sm text-red-600 dark:text-red-500 hover:bg-gray-100 dark:hover:bg-gray-600 cursor-pointer">{{ uiText.deleteAction }}</a>
                        </div>
                      </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
    </main>
  </div>

  <!-- Logout Modal -->
  <div *ngIf="isLogoutModalVisible" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
    <div class="bg-gray-100 dark:bg-gray-800 p-8 rounded-lg shadow-xl text-center">
      <p class="text-lg font-medium text-gray-900 dark:text-white mb-6">{{ uiText.logoutModalTitle }}</p>
      <div class="flex justify-center space-x-4">
        <button (click)="confirmLogout()" class="px-6 py-2 bg-red-600 text-white rounded-md hover:bg-red-700 transition">{{ uiText.yesButton }}</button>
        <button (click)="hideLogoutModal()" class="px-6 py-2 bg-gray-500 dark:bg-gray-600 text-white rounded-md hover:bg-gray-400 dark:hover:bg-gray-500 transition">{{ uiText.noButton }}</button>
      </div>
    </div>
  </div>

  <!-- Modify Status Modal -->
  <div *ngIf="isStatusModalVisible" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50">
    <div class="bg-white dark:bg-gray-800 p-8 rounded-lg shadow-xl text-left max-w-md w-full">
      <h3 class="text-xl font-bold text-gray-900 dark:text-white mb-6">{{ uiText.modifyStatusModalTitle }}</h3>
      <div *ngIf="alertToModify">
        <p class="text-sm text-gray-600 dark:text-gray-400 mb-2">
          <strong>{{ uiText.alertLabel }}:</strong> {{ alertToModify.tipo }} <br>
          <strong>{{ uiText.dateLabel }}:</strong> {{ alertToModify.fechaHora | date:'dd/MM/yyyy HH:mm' }}
        </p>
        <label for="status-select" class="block text-sm font-medium text-gray-700 dark:text-gray-400 mb-2 mt-4">{{ uiText.newStatusLabel }}</label>
        <select id="status-select" [(ngModel)]="selectedStatus" class="w-full px-3 py-2 bg-gray-100 dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-lg text-gray-900 dark:text-gray-100 focus:ring-purple-500 focus:border-purple-500">
          <option *ngFor="let status of statusOptions" [value]="status">{{ status }}</option>
        </select>
      </div>
      <div class="flex justify-end space-x-4 mt-8">
        <button (click)="hideStatusModal()" class="px-6 py-2 bg-gray-200 dark:bg-gray-600 text-gray-800 dark:text-gray-200 rounded-md hover:bg-gray-300 dark:hover:bg-gray-500 transition">{{ uiText.cancelButton }}</button>
        <button (click)="confirmStatusChange()" class="px-6 py-2 bg-purple-600 text-white rounded-md hover:bg-purple-700 transition">{{ uiText.confirmButton }}</button>
      </div>
    </div>
  </div>

  <!-- Delete Alert Modal -->
  <div *ngIf="isDeleteModalVisible" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50">
    <div class="bg-gray-100 dark:bg-gray-800 p-8 rounded-lg shadow-xl text-center max-w-sm mx-auto">
      <p *ngIf="alertToDelete" class="text-lg font-medium text-gray-900 dark:text-white mb-6">
        {{ uiText.deleteModalTitle }}
        <br>
        <strong class="font-normal text-sm text-gray-500 dark:text-gray-400">{{ alertToDelete.tipo }} - {{ alertToDelete.fechaHora | date:'dd/MM/yyyy HH:mm' }}</strong>
        <br><br>
        <span class="text-sm text-red-500 dark:text-red-400">{{ uiText.deleteModalWarning }}</span>
      </p>
      <div class="flex justify-center space-x-4">
        <button (click)="confirmDelete()" class="px-6 py-2 bg-red-600 text-white rounded-md hover:bg-red-700 transition">{{ uiText.confirmDeleteButton }}</button>
        <button (click)="hideDeleteModal()" class="px-6 py-2 bg-gray-500 dark:bg-gray-600 text-white rounded-md hover:bg-gray-400 dark:hover:bg-gray-500 transition">{{ uiText.cancelButton }}</button>
      </div>
    </div>
  </div>

  <!-- Details Modal -->
  <div *ngIf="isDetailsModalVisible" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50">
    <div class="bg-white dark:bg-gray-800 p-8 rounded-lg shadow-xl max-w-lg w-full">
      <h3 class="text-2xl font-bold text-gray-900 dark:text-white mb-6">Detalles de la Alerta</h3>
      <div *ngIf="alertToShowDetails" class="space-y-4 text-gray-700 dark:text-gray-300">
        
        <!-- Detalles para Guardia -->
        <div *ngIf="alertToShowDetails.origen === 'Guardia' && alertToShowDetails.detalles" class="space-y-3">
          <div>
            <p class="text-sm font-medium text-gray-500 dark:text-gray-400">Reportado por:</p>
            <p class="text-lg">{{ alertToShowDetails.detalles.nombreGuardia }} (ID: {{ alertToShowDetails.detalles.idGuardia }})</p>
          </div>
          <div>
            <p class="text-sm font-medium text-gray-500 dark:text-gray-400">Descripción Adicional:</p>
            <p class="p-3 bg-gray-100 dark:bg-gray-700 rounded-md border border-gray-200 dark:border-gray-600">{{ alertToShowDetails.detalles.descripcion }}</p>
          </div>
        </div>

        <!-- Detalles para IA -->
        <div *ngIf="alertToShowDetails.origen === 'IA' && alertToShowDetails.detalles" class="space-y-3">
          <div>
            <p class="text-sm font-medium text-gray-500 dark:text-gray-400">Cámara:</p>
            <p class="text-lg">Cámara {{ alertToShowDetails.detalles.camara.numero }} (ID: {{ alertToShowDetails.detalles.camara.id }})</p>
          </div>
          <div>
            <p class="text-sm font-medium text-gray-500 dark:text-gray-400">Dirección IP:</p>
            <p>{{ alertToShowDetails.detalles.camara.ip }}</p>
          </div>
          <div>
            <p class="text-sm font-medium text-gray-500 dark:text-gray-400">Descripción Automática:</p>
            <p class="p-3 bg-gray-100 dark:bg-gray-700 rounded-md border border-gray-200 dark:border-gray-600">{{ alertToShowDetails.detalles.descripcion }}</p>
          </div>
        </div>

      </div>
      <div class="flex justify-end mt-8">
        <button (click)="hideDetailsModal()" class="px-6 py-2 bg-purple-600 text-white rounded-md hover:bg-purple-700 transition">Cerrar</button>
      </div>
    </div>
  </div>
</div>